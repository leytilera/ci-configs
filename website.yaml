steps:
    - name: build
      image: alpine
      commands:
        - apk add zola
        - zola build
    - name: upload
      image: rclone/rclone:latest
      secrets: [ web_pw ]
      commands:
        - export RCLONE_SFTP_PASS="$(rclone obscure $WEB_PW)"
        - rclone sync ./public/ :sftp:/home/webmaster/${DRONE_REPO_OWNER}/${DRONE_REPO_NAME}
      environment:
        RCLONE_SFTP_HOST: git.tilera.org
        RCLONE_SFTP_USER: webmaster
        RCLONE_SFTP_PORT: "2220"
      when:
          branch: master
          event: push
      depends_on:
          - build