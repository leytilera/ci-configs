kind: pipeline
type: docker
name: release

steps:
    - name: build
      image: adoptopenjdk/openjdk8
      commands:
          - chmod +x gradlew
          - ./gradlew build
    - name: maven
      image: adoptopenjdk/openjdk8
      environment:
        ORG_GRADLE_PROJECT_mvnURL: https://maven.tilera.xyz
        ORG_GRADLE_PROJECT_mvnUsername: tilera
        ORG_GRADLE_PROJECT_mvnPassword:
            from_secret: gitea_token
      commands:
          - chmod +x gradlew
          - ./gradlew publish
      depends_on:
          - build
      when:
          event: tag