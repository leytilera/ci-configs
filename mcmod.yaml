kind: pipeline
type: docker
name: release

steps:
    - name: build
      image: adoptopenjdk/openjdk8
      commands:
          - chmod +x gradlew
          - ./gradlew build
    - name: publish
      image: plugins/gitea-release
      settings:
          base_url: https://git.tilera.org
          api_key:
              from_secret: gitea_token
          note: CHANGELOG.md
          title: ${DRONE_TAG}
          files:
              - build/libs/*
      when:
          event: tag
      depends_on:
          - build
    - name: maven
      image: adoptopenjdk/openjdk8
      environment:
        ORG_GRADLE_PROJECT_mvnURL: https://data.tilera.xyz/maven
        ORG_GRADLE_PROJECT_mvnUsername: tilera
        ORG_GRADLE_PROJECT_mvnPassword:
            from_secret: mvn_pw
      commands:
          - chmod +x gradlew
          - ./gradlew publish
      when:
          event: tag